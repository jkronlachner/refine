var $=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var R=Object.prototype.hasOwnProperty;var _=(r,n)=>{for(var s in n)$(r,s,{get:n[s],enumerable:!0})},C=(r,n,s,e)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of L(n))!R.call(r,o)&&o!==s&&$(r,o,{get:()=>n[o],enumerable:!(e=x(n,o))||e.enumerable});return r};var O=r=>C($({},"__esModule",{value:!0}),r);var F={};_(F,{createClient:()=>P.createClient,dataProvider:()=>j,generateFilter:()=>S,handleError:()=>p,liveProvider:()=>A,liveTypes:()=>h,mapOperator:()=>f,supabaseTypes:()=>N});module.exports=O(F);var P=require("@supabase/supabase-js");var g=require("@supabase/supabase-js"),h={INSERT:"created",UPDATE:"updated",DELETE:"deleted","*":"*"},N={created:g.REALTIME_POSTGRES_CHANGES_LISTEN_EVENT.INSERT,updated:g.REALTIME_POSTGRES_CHANGES_LISTEN_EVENT.UPDATE,deleted:g.REALTIME_POSTGRES_CHANGES_LISTEN_EVENT.DELETE,"*":g.REALTIME_POSTGRES_CHANGES_LISTEN_EVENT.ALL};var f=r=>{switch(r){case"ne":return"neq";case"nin":return"not.in";case"contains":return"ilike";case"ncontains":return"not.ilike";case"containss":return"like";case"ncontainss":return"not.like";case"null":return"is";case"nnull":return"not.is";case"ina":return"cs";case"nina":return"not.cs";case"between":case"nbetween":throw Error(`Operator ${r} is not supported`);default:return r}};var S=(r,n)=>{switch(r.operator){case"eq":return n.eq(r.field,r.value);case"ne":return n.neq(r.field,r.value);case"in":return n.in(r.field,r.value);case"ina":return n.contains(r.field,r.value);case"nina":return n.not(r.field,"cs",`{${r.value.map(s=>`"${s}"`).join(",")}}`);case"gt":return n.gt(r.field,r.value);case"gte":return n.gte(r.field,r.value);case"lt":return n.lt(r.field,r.value);case"lte":return n.lte(r.field,r.value);case"between":if(r.value.length!==2)throw new Error(`[@refinedev/supabase]: Unexpected length ${r.value.length}. Between operator expects a range between 2 values.`);return n.gte(r.field,r.value[0]).lte(r.field,r.value[1]);case"contains":return n.ilike(r.field,`%${r.value}%`);case"containss":return n.like(r.field,`%${r.value}%`);case"null":return n.is(r.field,null);case"startswith":return n.ilike(r.field,`${r.value}%`);case"endswith":return n.ilike(r.field,`%${r.value}`);case"or":{let s=r.value.map(e=>{if(e.operator!=="or"&&e.operator!=="and"&&"field"in e){let o=e.value;return(e.operator==="ina"||e.operator==="nina")&&(o=`{${e.value.map(c=>`"${c}"`).join(",")}}`),(e.operator==="contains"||e.operator==="containss")&&(o=`%${o}%`),e.operator==="startswith"&&(o=`${o}%`),e.operator==="endswith"&&(o=`%${o}`),e.operator==="in"&&(o=`(${e.value.map(c=>`"${c}"`).join(",")})`),`${e.field}.${f(e.operator)}.${o}`}}).join(",");return n.or(s)}case"and":throw Error("Operator 'and' is not supported");default:return n.filter(r.field,f(r.operator),r.value)}};var p=r=>{let n={...r,message:r.message,statusCode:Number.parseInt(r.code)};return Promise.reject(n)};var j=r=>({getList:async({resource:n,pagination:s,filters:e,sorters:o,meta:c})=>{let{current:a=1,pageSize:i=10,mode:d="server"}=s??{},l=(c!=null&&c.schema?r.schema(c.schema):r).from(n).select((c==null?void 0:c.select)??"*",{count:(c==null?void 0:c.count)??"exact"});d==="server"&&l.range((a-1)*i,a*i-1),o==null||o.map(t=>{let[u,T]=t.field.split(/\.(?=[^.]+$)/);u&&T?l.select((c==null?void 0:c.select)??`*, ${u}(${T})`).order(T,{ascending:t.order==="asc",foreignTable:u}):l.order(t.field,{ascending:t.order==="asc"})}),e==null||e.map(t=>{S(t,l)});let{data:w,count:E,error:y}=await l;return y?p(y):{data:w||[],total:E||0}},getMany:async({resource:n,ids:s,meta:e})=>{let c=(e!=null&&e.schema?r.schema(e.schema):r).from(n).select((e==null?void 0:e.select)??"*");e!=null&&e.idColumnName?c.in(e.idColumnName,s):c.in("id",s);let{data:a,error:i}=await c;return i?p(i):{data:a||[]}},create:async({resource:n,variables:s,meta:e})=>{let c=(e!=null&&e.schema?r.schema(e.schema):r).from(n).insert(s);c.select((e==null?void 0:e.select)??"*");let{data:a,error:i}=await c;return i?p(i):{data:(a||[])[0]}},createMany:async({resource:n,variables:s,meta:e})=>{let c=(e!=null&&e.schema?r.schema(e.schema):r).from(n).insert(s);c.select((e==null?void 0:e.select)??"*");let{data:a,error:i}=await c;return i?p(i):{data:a}},update:async({resource:n,id:s,variables:e,meta:o})=>{let a=(o!=null&&o.schema?r.schema(o.schema):r).from(n).update(e);o!=null&&o.idColumnName?a.eq(o.idColumnName,s):a.match({id:s}),a.select((o==null?void 0:o.select)??"*");let{data:i,error:d}=await a;return d?p(d):{data:(i||[])[0]}},updateMany:async({resource:n,ids:s,variables:e,meta:o})=>({data:await Promise.all(s.map(async a=>{let d=(o!=null&&o.schema?r.schema(o.schema):r).from(n).update(e);o!=null&&o.idColumnName?d.eq(o.idColumnName,a):d.match({id:a}),d.select((o==null?void 0:o.select)??"*");let{data:v,error:l}=await d;return l?p(l):(v||[])[0]}))}),getOne:async({resource:n,id:s,meta:e})=>{let c=(e!=null&&e.schema?r.schema(e.schema):r).from(n).select((e==null?void 0:e.select)??"*");e!=null&&e.idColumnName?c.eq(e.idColumnName,s):c.match({id:s});let{data:a,error:i}=await c;return i?p(i):{data:(a||[])[0]}},deleteOne:async({resource:n,id:s,meta:e})=>{let c=(e!=null&&e.schema?r.schema(e.schema):r).from(n).delete();e!=null&&e.idColumnName?c.eq(e.idColumnName,s):c.match({id:s});let{data:a,error:i}=await c;return i?p(i):{data:(a||[])[0]}},deleteMany:async({resource:n,ids:s,meta:e})=>({data:await Promise.all(s.map(async c=>{let i=(e!=null&&e.schema?r.schema(e.schema):r).from(n).delete();e!=null&&e.idColumnName?i.eq(e.idColumnName,c):i.match({id:c});let{data:d,error:v}=await i;return v?p(v):(d||[])[0]}))}),getApiUrl:()=>{throw Error("Not implemented on refine-supabase data provider.")},custom:()=>{throw Error("Not implemented on refine-supabase data provider.")}});var A=r=>({subscribe:({channel:n,types:s,params:e,callback:o,meta:c})=>{var y;let a=n.replace("resources/",""),i=t=>{var u;(s.includes("*")||s.includes(h[t.eventType]))&&(h[t.eventType]!=="created"&&(e==null?void 0:e.ids)!==void 0&&((u=t.new)==null?void 0:u.id)!==void 0?e.ids.map(String).includes(t.new.id.toString())&&o({channel:n,type:h[t.eventType],date:new Date(t.commit_timestamp),payload:t.new}):o({channel:n,type:h[t.eventType],date:new Date(t.commit_timestamp),payload:t.new}))},d=t=>{if(!(!t||(t==null?void 0:t.length)===0))return t.map(u=>{if("field"in u)return`${u.field}=${f(u.operator)}.${u.value}`}).filter(Boolean).join(",")},v=s.map(t=>N[t]).sort((t,u)=>t.localeCompare(u)),l=d(e==null?void 0:e.filters),w=`${n}:${v.join("|")}${l?`:${l}`:""}`,E=r.channel(w);for(let t=0;t<v.length;t++)E=E.on("postgres_changes",{event:v[t],schema:(c==null?void 0:c.schema)||((y=r==null?void 0:r.rest)==null?void 0:y.schemaName)||"public",table:a,filter:l},i);return E.subscribe()},unsubscribe:async n=>{r.removeChannel(n)}});
//# sourceMappingURL=index.cjs.map